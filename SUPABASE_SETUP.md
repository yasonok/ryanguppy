# Supabase 資料庫設定

## SQL Schema

```sql
-- 1. 建立 products 資料表
CREATE TABLE products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  type TEXT,
  gender TEXT,
  price INTEGER NOT NULL,
  stock INTEGER DEFAULT 0,
  image_url TEXT,
  status TEXT DEFAULT 'available',
  note TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. 建立 orders 資料表
CREATE TABLE orders (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  customer_name TEXT NOT NULL,
  customer_phone TEXT,
  customer_line_id TEXT,
  shipping_address TEXT,
  total_amount INTEGER NOT NULL,
  status TEXT DEFAULT 'pending', -- pending, confirmed, shipped, completed, cancelled
  note TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 3. 建立 order_items 資料表
CREATE TABLE order_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  order_id BIGINT REFERENCES orders(id),
  product_id BIGINT REFERENCES products(id),
  product_name TEXT NOT NULL,
  price INTEGER NOT NULL,
  quantity INTEGER NOT NULL,
  subtotal INTEGER NOT NULL
);

-- 4. 建立 customers 資料表（簡化版）
CREATE TABLE customers (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  line_id TEXT UNIQUE,
  name TEXT,
  phone TEXT,
  email TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 5. 建立 cart_items 資料表（可選，用資料庫管理購物車）
CREATE TABLE cart_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  session_id TEXT NOT NULL,
  product_id BIGINT REFERENCES products(id),
  quantity INTEGER DEFAULT 1,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## RLS 權限設定

```sql
-- 顧客只能讀取商品和下單
CREATE POLICY "Public products read" ON products
  FOR SELECT USING (true);

CREATE POLICY "Public orders create" ON orders
  FOR INSERT WITH CHECK (true);

CREATE POLICY "Public order_items create" ON order_items
  FOR INSERT WITH CHECK (true);

-- 管理員可以完整操作
CREATE POLICY "Admin full access" ON products
  FOR ALL USING (true);

CREATE POLICY "Admin orders access" ON orders
  FOR ALL USING (true);
```

## 下一步
1. 在 Supabase Dashboard 執行上述 SQL
2. 填入 js/app.js 的連接資訊
3. 測試新增/編輯/刪除商品
4. 測試購物車和下單功能
